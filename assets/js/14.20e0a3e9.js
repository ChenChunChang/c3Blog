(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{342:function(a,s,t){"use strict";t.r(s);var e=t(3),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"问题起源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题起源"}},[a._v("#")]),a._v(" 问题起源")]),a._v(" "),s("p",[a._v("问题起源于我在使用Docker部署的Jenkins服务时，需要通过Jenkins实现Docker的持续集成，尝试使用Docker的远程Api，\n但是由于本机服务器内存不足的原因，在build镜像时总是出现内存溢出的错误。")]),a._v(" "),s("h2",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[a._v("#")]),a._v(" 解决方案")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" root "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":8080 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(":50000 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /var/run/docker.sock:/var/run/docker.sock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("which")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/bin/docker "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" jenkins:/var/jenkins_home "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtime:/etc/localtime "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" jenkins docker.io/jenkins/jenkins\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("h2",{attrs:{id:"解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析"}},[a._v("#")]),a._v(" 解析")]),a._v(" "),s("h3",{attrs:{id:"_1-privileged"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-privileged"}},[a._v("#")]),a._v(" 1. --privileged")]),a._v(" "),s("p",[a._v("大约在0.6版，privileged被引入docker。使用该参数，container内的root拥有真正的root权限。\n否则，container内的root只是外部的一个普通用户权限。")]),a._v(" "),s("h3",{attrs:{id:"_2-u-root"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-u-root"}},[a._v("#")]),a._v(" 2. "),s("strong",[a._v("-u root")])]),a._v(" "),s("p",[a._v("使用root用户创建容器")]),a._v(" "),s("blockquote",[s("p",[a._v("只使用"),s("code",[a._v("--privileged")]),a._v("仍不能获取root权限（不知道为啥），但是加上"),s("code",[a._v("-u root")]),a._v("就可以了")])]),a._v(" "),s("h3",{attrs:{id:"_3-挂载宿主机docker文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-挂载宿主机docker文件"}},[a._v("#")]),a._v(" 3. 挂载宿主机Docker文件")]),a._v(" "),s("p",[s("code",[a._v("/var/run/docker.sock")]),a._v("：Unix socket，Docker进程默认监听文件，为进行container进程间通信所用。")]),a._v(" "),s("p",[s("code",[a._v("$(which docker)")]),a._v("：将docker命令挂载进容器中")]),a._v(" "),s("p",[s("code",[a._v("/etc/localtime")]),a._v("：解决容器与宿主机的时间时区不一致的问题")])])}),[],!1,null,null,null);s.default=r.exports}}]);